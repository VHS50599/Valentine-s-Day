<!DOCTYPE html>
<html>
<head>
<title>Para Mi Monita Hermosa ❤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    background-color: #b180f0;
    text-align: center;
    margin: 0;
    font-family: Arial, sans-serif;
    overflow: hidden;
    position: relative;
    min-height: 100vh;
  }

  h1, p {
    color: white;
    z-index: 10;
    position: relative;
    margin: 20px;
  }

  h1 { font-size: clamp(28px, 8vw, 50px); }
  p { font-size: clamp(18px, 5vw, 30px); }

  .heart {
    position: absolute;
    color: white;
    user-select: none;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  #bouquet {
    position: fixed;
    left: 50%;
    top: 55%;
    transform: translate(-50%, -50%) scale(0.5);
    opacity: 0;
    transition: transform 1.5s ease, opacity 1.5s ease;
    z-index: 5;
    width: 400px;
  }
</style>
</head>
<body>

<h1>Feliz Día De San Valentín</h1>
<p>Eres lo más importante que tengo.</p>

<img id="bouquet" src="bouquet.png" alt="Bouquet">

<script>
const numHearts = 200;
const hearts = [];
const heartPositions = [];
const heartSizes = [];
let forming = false;

// Grab text boundaries
function getTextRects() {
  const rects = [];
  const elements = document.querySelectorAll('h1, p');
  elements.forEach(el => {
    rects.push(el.getBoundingClientRect());
  });
  return rects;
}

// Check overlap between two circles
function isOverlapping(x1, y1, r1, x2, y2, r2) {
  const dx = x1 - x2;
  const dy = y1 - y2;
  const distance = Math.sqrt(dx*dx + dy*dy);
  return distance < r1 + r2;
}

// Check if heart overlaps any text rect
function overlapsText(x, y, r, textRects) {
  for (const rect of textRects) {
    // Find closest point in rect to circle center
    const closestX = Math.max(rect.left, Math.min(x, rect.right));
    const closestY = Math.max(rect.top, Math.min(y, rect.bottom));
    const dx = x - closestX;
    const dy = y - closestY;
    const distance = Math.sqrt(dx*dx + dy*dy);
    if (distance < r) return true;
  }
  return false;
}

// Find random position avoiding hearts and text
function getNonOverlappingPosition(radius) {
  const maxAttempts = 200;
  let attempt = 0;
  const textRects = getTextRects();
  while (attempt < maxAttempts) {
    const x = Math.random() * (window.innerWidth - 2*radius) + radius;
    const y = Math.random() * (window.innerHeight - 2*radius) + radius;

    let overlap = false;

    // Check other hearts
    for (let i=0; i<heartPositions.length; i++) {
      if (isOverlapping(x, y, radius, heartPositions[i].x, heartPositions[i].y, heartSizes[i])) {
        overlap = true;
        break;
      }
    }

    // Check text
    if (!overlap && overlapsText(x, y, radius, textRects)) {
      overlap = true;
    }

    if (!overlap) return { x, y };
    attempt++;
  }
  return null;
}

// Create hearts
for(let i=0; i<numHearts; i++){
  const heart = document.createElement("div");
  heart.className = "heart";
  heart.innerHTML = "\u2764\uFE0E";

  const fontSize = 15 + Math.random() * 25;
  heart.style.fontSize = fontSize + "px";
  const radius = fontSize * 0.6;

  document.body.appendChild(heart);
  hearts.push(heart);
  heartSizes.push(radius);
  heartPositions.push({ x: 0, y: 0 });
}

// Animate single heart
function animateHeart(i) {
  const heart = hearts[i];
  const radius = heartSizes[i];

  function blink() {
    // Pick new position avoiding text and other hearts
    const pos = getNonOverlappingPosition(radius);
    if (pos) {
      heart.style.left = pos.x + "px";
      heart.style.top = pos.y + "px";
      heartPositions[i] = { x: pos.x, y: pos.y };
    }

    // Show heart
    heart.style.opacity = 1;

    // Visible time
    const visibleTime = 800 + Math.random()*700;

    setTimeout(() => {
      heart.style.opacity = 0;
      const invisibleTime = 300 + Math.random()*700; // stagger
      setTimeout(blink, invisibleTime);
    }, visibleTime);
  }

  blink();
}

// Start all hearts
for(let i=0; i<hearts.length; i++){
  setTimeout(() => animateHeart(i), Math.random()*1000);
}

// Click to show bouquet
document.addEventListener("click", () => {
  if (forming) return;
  forming = true;

  setTimeout(() => {
    const bouquet = document.getElementById("bouquet");
    bouquet.style.opacity = 1;
    bouquet.style.transform = "translate(-50%, -50%) scale(1)";
  }, 900);
});
</script>

</body>
</html>